<!DOCTYPE html>
<!-- Template by Quackit.com -->
<!-- Images by various sources under the Creative Commons CC0 license and/or the Creative Commons Zero license. 
Although you can use them, for a more unique website, replace these images with your own. -->
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <title>Projekt Grupowy - Regulator temperatury z interfejsem Bluetooth Low Energy</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS: You can use this stylesheet to override any Bootstrap styles and/or apply your own styles -->
    <link href="css/custom.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom Fonts from Google -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    
</head>

<body>

    <!-- Navigation -->
    <nav id="siteNav" class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Logo and responsive toggle -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">
                	<span class="glyphicon glyphicon-fire"></span> 
                	Projekt Grupowy 2018/2019
                </a>
            </div>
            <!-- Navbar links -->
            <div class="collapse navbar-collapse" id="navbar">
                <ul class="nav navbar-nav navbar-right">
                    <li class="active">
                        <a href="#">Home</a>
                    </li>
                    <li>
                        <a href="#">Products</a>
                    </li>
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Services <span class="caret"></span></a>
						<ul class="dropdown-menu" aria-labelledby="about-us">
							<li><a href="#">Engage</a></li>
							<li><a href="#">Pontificate</a></li>
							<li><a href="#">Synergize</a></li>
						</ul>
					</li>
                    <li>
                        <a href="#">Contact</a>
                    </li>
                </ul>
                
            </div><!-- /.navbar-collapse -->
        </div><!-- /.container -->
    </nav>

	<!-- Header -->
    <header>
        <div class="header-content">
            <div class="header-content-inner">
                <h1>Regulator temperatury</h1>
				<h2>Z interfejsem Bluetooth Low Energy</h2>
				<p class="text-light">Projekt 5@KSME’2018 - Katedra Systemów Mikroelektronicznych</p>
	    	       
				<div class="row">
					<div class="col-md-6" id="read_part">	    
						<div class="read_temperature">
							<label for="read_data">Current temperature: </label>
							<span id="read_data"></span>
						</div>
						<div class="read_regulator_temperature">
							<label for="read_regulator">Temperature set for regulator: </label>
							<span id="read_regulator"></span>
						</div>
					</div>
					<div class="col-md-6" id="write_part">
						<div class="form-group">
							<label for="set_data">Set temperature (in Celcius):</label>
							<input type="text" class="form-control" id="set_data" name="set_data" required
								   minlength="1" maxlength="3"
								   placeholder="1 to 3 characters long" />
						</div>
					</div>
				</div>
		    	<div class="row">
					<div class="col-md-6" id="read_part_btn">
						<a href="#" id="readBtn" class="btn btn-primary btn-lg">Read</a>
					</div>
					<div class="col-md-6" id="write_part_btn">
						<a href="#" id="writeBtn" class="btn btn-primary btn-lg">Write</a>
					</div>
				</div>
            </div>
        </div>
    </header>

	<!-- Intro Section -->
    <section class="intro">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2">
                	<span class="glyphicon glyphicon-user" style="font-size: 60px"></span>
                    <h2 class="section-heading">Skład zespołu</h2>
                    <p class="text-light">Mariusz, Justyna, Jakub, Sebastian, Rafał</p>
                </div>
            </div>
        </div>
    </section>
    
	<!-- Footer -->
    <footer class="page-footer">
    
    	<!-- Contact Us -->
        <div class="contact">
        	<div class="container">
				<h2 class="section-heading">Contact Us</h2>
				<p><span class="glyphicon glyphicon-earphone"></span><br> +1(23) 456 7890</p>
				<p><span class="glyphicon glyphicon-envelope"></span><br> info@example.com</p>
        	</div>
        </div>
        	
        <!-- Copyright etc -->
        <div class="small-print">
        	<div class="container">
        		<p>Copyright &copy; Example.com 2015</p>
        	</div>
        </div>
        
    </footer>

    <!-- jQuery -->
    <script src="js/jquery-1.11.3.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="js/jquery.easing.min.js"></script>
    
    <!-- Custom Javascript -->
    <script src="js/custom.js">
	    
    var readBtn = document.getElementById("readBtn");
    var writeBtn = document.getElementById("writeBtn");
    
    console.log("Found button.\n");
    
    readBtn.addEventListener('click', function(event) {
        console.log("Button clicked.\n");
        navigator.bluetooth.requestDevice({
                acceptAllDevices: true,
                optionalServices: ['31f45c45-8e0d-4c88-94f7-718a38048536'] 
            })
            .then(device => {
                console.log(device.name);
                return device.gatt.connect();
            })
            .then(server => {
              return server.getPrimaryService('31f45c45-8e0d-4c88-94f7-718a38048536');
            })
            .then(service => {
              return service.getCharacteristic('31F45C46-E0D4-C889-4F77-18A380485360'.toLowerCase());
            })
            .then(characteristic => {
              return characteristic.readValue();
            })
            .then(value => {
                console.log(value);
                console.log('Value R is ' + value.getUint8(0));
                console.log('Value G is ' + value.getUint8(1));
                console.log('Value B is ' + value.getUint8(2));
                console.log('Value I is ' + value.getUint8(3));
                console.log('Value S is ' + value.getUint8(4));
                document.getElementById("read_regulator").innerHTML = value.getUint8(0);
                document.getElementById("read_data").innerHTML = value.getUint8(4);
            })
            .catch(error => { 
                console.log(error); 
            });
    });
    
    writeBtn.addEventListener('click', function(event) {
        console.log("Button clicked.\n");
        navigator.bluetooth.requestDevice({
                acceptAllDevices: true,
                optionalServices: ['31f45c45-8e0d-4c88-94f7-718a38048536'] 
            })
            .then(device => {
                console.log(device.name);
                return device.gatt.connect();
            })
            .then(server => {
              return server.getPrimaryService('31f45c45-8e0d-4c88-94f7-718a38048536');
            })
            .then(service => {
              return service.getCharacteristic('31F45C46-E0D4-C889-4F77-18A380485360'.toLowerCase());
            })
            .then(characteristic => {
                var val = document.getElementById("set_data").value;
                var s = new Set([val, 0, 0, 0, 0]);
                var arr = Uint8Array.from(s);
                return characteristic.writeValue(arr);
            })
            .then(_ => {
                console.log('Value is written to device');
            })
            .catch(error => { 
                console.log(error); 
            });
    });
	</script>

</body>

</html>
